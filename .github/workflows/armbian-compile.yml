name: RK3128 Armbian Compile
on:
  workflow_dispatch:
    inputs:
      BOARD:
        description: '开发板型号'
        required: true
        default: 'firefly-rk3128'
      RELEASE:
        description: '系统版本'
        required: true
        default: 'bullseye'
jobs:
  compile:
    runs-on: ubuntu-22.04
    steps:
      - name: 拉取Armbian源码
        uses: actions/checkout@v4
        with:
          repository: armbian/build
          ref: main
      - name: 安装编译依赖
        run: sudo ./scripts/host-prepare.sh
      - name: 复制RK3128配置文件
        run: |
          mkdir -p config/boards
          echo '${{ env.BOARD_CONF }}' > config/boards/firefly-rk3128.conf
      - name: 开始编译
        run: |
          ./compile.sh BOARD=${{ github.event.inputs.BOARD }} BRANCH=legacy RELEASE=${{ github.event.inputs.RELEASE }} BUILD_MINIMAL=yes
      - name: 上传固件
        uses: actions/upload-artifact@v4
        with:
          name: Armbian-RK3128-Image
          path: output/images/*.img
env:
  BOARD_CONF: |
    BOARD_NAME="TXCZ-RK3128-V3.1"
    BOARD_TYPE="normal"
    BOARD_FAMILY="rockchip"
    BOARD_KERNEL_ARCH="arm"
    BOARD_KERNEL_DTS="rk3128"
    BOARD_KERNEL_IMAGE="zImage"
    BOARD_ROOTFS_TYPE="ext4"
    BOARD_ROOTFS_SIZE="1G"
    BOARD_DTB_FILE="rk3128.dtb"
    BOARD_KERNEL_VERSION="5.15.137"
    BOARD_MAINTAINER="Aishiniwo789"
